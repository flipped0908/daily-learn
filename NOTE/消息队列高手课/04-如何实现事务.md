
创建订单的过程中实际上执行了 2 个步骤
    订单库中插入一条订单数据，创建订单；
    发消息给消息队列，消息的内容就是刚刚创建的订单。

创建了订单，没有清理购物车
订单没创建成功，购物车里面的商品却被清掉了

### 消息队列是如何实现分布式事务

首先，订单系统在消息队列上开启一个事务。然后订单系统给消息服务器发送一个“半消息”，这个半消息不是说消息内容不完整，它包含的内容就是完整的消息内容，半消息和普通消息的唯一区别是，在事务提交之前，对于消费者来说，这个消息是不可见的

就是在消费者端进行一个事务。在这个事务里包含，创建订单，提交订单到消息队列，不包含消费成功与否。

那么消费端就是购物系统，用消息队列实现了，订单系统和购物车系统的解耦。

但是如果在提交或者回滚失败的情况下，需要去补偿。

就是将消息队列生产者之间的事务放在一起。




