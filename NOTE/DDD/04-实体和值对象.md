
在有些复杂场景下，实体与持久化对象则可能是一对多或者多对一的关系。比如，用户 user 与角色 role 两个持久化对象可生成权限实体，一个实体对应两个持久化对象，这是一对多的场景。

再比如，有些场景为了避免数据库的联表查询，提升系统性能，会将客户信息 customer 和账户信息 account 两类数据保存到同一张数据库表中，客户和账户两个实体可根据需要从一个持久化对象中生成，这就是多对一的场景


## 值对象

《实现领域驱动设计》一书中对值对象的定义：通过对象属性值来识别的对象，它将多个相关属性组合为一个概念整体。在 DDD 中用来描述领域的特定方面，并且是一个没有标识符的对象，叫作值对象

简单来说，值对象本质上就是一个集


    领域模型                     数据模型

    人员                       人员
    id                        id
    name                      name
    age                       age
    sex                       sex
    address  <-> ADDRESS      省
                省            市
                市            区
                区            街道
                街道 

1. 值对象的业务形态
   本质上，实体是看得到、摸得着的实实在在的业务对象，实体具有业务属性、业务行为和业务逻辑。而值对象只是若干个属性的集合，只有数据初始化操作和有限的不涉及修改数据的行为，基本不包含业务逻辑。

2. 值对象的代码形态
   如果值对象是单一属性，则直接定义为实体类的属性；如果值对象是属性集合，则把它设计为 Class 类，Class 将具有整体概念的多个属性归集到属性集合，这样的值对象没有 ID，会被实体整体引用

3. 值对象的运行形态
   实体实例化后的 DO 对象的业务属性和业务行为非常丰富，但值对象实例化的对象则相对简单和乏味。除了值对象数据初始化和整体替换的行为外，其它业务行为就很少了

4. 值对象的数据库形态
    DDD 引入值对象是希望实现从“数据建模为中心”向“领域建模为中心”转变，减少数据库表的数量和表与表之间复杂的依赖关系，尽可能地简化数据库设计，提升数据库性能

    传统的数据建模大多是根据数据库范式设计的，每一个数据库表对应一个实体，每一个实体的属性值用单独的一列来存储，一个实体主表会对应 N 个实体从表。而值对象在数据库持久化方面简化了设计，它的数据库设计大多采用非数据库范式，值对象的属性值和实体对象的属性值保存在同一个数据库实体表中。
    
    反范式

### 那到底应该怎样设计，才能让业务含义清楚，同时又不让数据库变得复杂呢？

值对象就是通过这种方式，简化了数据库设计，总结一下就是：在领域建模时，我们可以将部分对象设计为值对象，保留对象的业务涵义，同时又减少了实体的数量；在数据建模时，我们可以将值对象嵌入实体，减少实体表的数量，简化数据库设计。

mysql 和 mongo 关系型和非关系型

也有 DDD 专家认为，要想发挥对象的威力，就需要优先做领域建模，弱化数据库的作用，只把数据库作为一个保存数据的仓库即可。即使违反数据库设计原则，也不用大惊小怪，只要业务能够顺利运行，就没什么关系。

> 我常思考的一个问题，因为用关系型数据库时间久和范式思想的固有思维模式，总是在考虑业务的时候呢就会不自觉的去想怎么设计数据库更合适，使用mongo之后由于之前一直用mysql 所以很不适应不知道到底怎么设计数据库合理，因为数据结构设计的不合理会对以后的架构产生很大的影响，不好维护，这种DDD的思想解开了我的谜团。

5. 值对象的优势和局限
    值对象是一把双刃剑，它的优势是可以简化数据库设计，提升数据库性能。但如果值对象使用不当，它的优势就会很快变成劣势。“知彼知己，方能百战不殆”，你需要理解值对象真正适合的场景

    值对象采用序列化大对象的方法简化了数据库设计，减少了实体表的数量，可以简单、清晰地表达业务概念。这种设计方式虽然降低了数据库设计的复杂度，但却无法满足基于值对象的快速查询，会导致搜索值对象属性值变得异常困难。


### 实体和值对象的关系

其实，DDD 引入值对象还有一个重要的原因，就是到底领域建模优先还是数据建模优先？

DDD 提倡从领域模型设计出发，而不是先设计数据模型。前面讲过了，传统的数据模型设计通常是一个表对应一个实体，一个主表关联多个从表，当实体表太多的时候就很容易陷入无穷无尽的复杂的数据库设计，领域模型就很容易被数据模型绑架。可以说，值对象的诞生，在一定程度上，和实体是互补的。

最终将适合自己业务的 DDD 设计方法纳入到架构体系，实现落地。


>  我认为在项目初期采用领域优先的模式，可以快速的开发和迭代，适应变化的需求，当趋于稳定的时候就可以转为固定的实体类型。或者不转换也可以在不影响性能的情况下。
> 在代码层面要设计成固有的形式。以便在底层转为为固有的时候后可以很好的过渡。
> 在优化阶段可以考虑设计成固有的实体类型。


简单的说就是在设计的表中，是否包含值对象，就是对象嵌套之后，在表中是分开的还是放在了一个表中。就比如人的信息中的地址的信息是单独放还是放在一起，还是数据结构的设计。

