### 一个hadoop的例子
你知道 Hadoop 1.0 中的 NameNode 是单点的，一旦发生故障则整个集群就会不可用；而在 Hadoop2 中提出的 NameNode HA 方案就是同时启动两个 NameNode，一个处于 Active 状态，另一个处于 Standby 状态，两者共享存储，一旦 Active NameNode 发生故障，则可以将 Standby NameNode 切换成 Active 状态继续提供服务，这样就增强了 Hadoop 的持续无故障运行的能力，也就是提升了它的可用性

### 高可用系统设计思路

1. 系统设计
   Design for failure”是我们做高可用系统设计时秉持的第一原则
   预先考虑如何自动化地发现故障，发生故障之后要如何解决 ，这不可能完全考虑到，需要经验
   具体的优化方法，比如failover（故障转移）、超时控制以及降级和限流。


#### 一般来说，发生 failover 的节点可能有两种情况：
1. 是在完全对等的节点之间做 failover。
    无状态的，可以迁移故障
    例如：Nginx 可以配置当某一个 Tomcat 出现大于 500 的请求的时候，重试请求另一个 Tomcat 节点

2. 是在不对等的节点之间，即系统中存在主节点也存在备节点。  
    热备（同样在线提供服务的备用节点），也可以是冷备（只作为备份使用）  
    使用最广泛的故障检测机制是“心跳”    
    当一段时间内未收到心跳包，就可以认为主节点已经发生故障，可以触发选主的操作  

#### 系统间调用超时的控制也是高可用系统设计的一个重要考虑方面
    复杂的高并发系统通常会有很多的系统模块组成，同时也会依赖很多的组件和服务，比如说缓存组件，队列服务等等。它们之间的调用最怕的就是延迟而非失败，因为失败通常是瞬时的，可以通过重试的方式解决。而一旦调用某一个模块或者服务发生比较大的延迟，调用方就会阻塞在这次调用上，它已经占用的资源得不到释放。当存在大量这种阻塞请求时，调用方就会因为用尽资源而挂掉。
    > 不怕失败，就怕延时 ，所以超时设置的必要性

通过收集系统之间的调用日志，统计比如说 99% 的响应时间是怎样的，然后依据这个时间来指定超时时间。如果没有调用的日志，那么你只能按照经验值来指定超时时间。不过，无论你使用哪种方式，超时时间都不是一成不变的，需要在后面的系统维护过程中不断地修改。
    > 分析日志查看调用链    




3. 系统运维